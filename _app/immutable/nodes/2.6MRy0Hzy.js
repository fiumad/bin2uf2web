import"../chunks/DsnmJJEf.js";import{i as Je}from"../chunks/CsmJTijE.js";import{o as Ke,e as xe,s as U}from"../chunks/Dc6l01TL.js";import{ar as fe,as as Qe,T as Ze,_ as et,at as tt,au as nt,aq as at,v as Ue,av as Oe,h as Te,g as O,aw as rt,C as st,D as F,Q as ot,O as f,G as T,K as u,y as i,I as A,J as it,ax as lt,ay as y,M as d,az as ct,aA as ne,aB as m,aC as ft}from"../chunks/dyQFexKm.js";import{i as D}from"../chunks/BypayQh6.js";import{s as ae,r as re}from"../chunks/Bm0bojIj.js";function Ce(e,t,n=!1){if(e.multiple){if(t==null)return;if(!et(t))return tt();for(var a of e.options)a.selected=t.includes(R(a));return}for(a of e.options){var s=R(a);if(nt(s,t)){a.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function ut(e){var t=new MutationObserver(()=>{Ce(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ze(()=>{t.disconnect()})}function dt(e,t,n=t){var a=!0;fe(e,"change",s=>{var o=s?"[selected]":":checked",c;if(e.multiple)c=[].map.call(e.querySelectorAll(o),R);else{var v=e.querySelector(o)??e.querySelector("option:not([disabled])");c=v&&R(v)}n(c)}),Qe(()=>{var s=t();if(Ce(e,s,a),a&&s===void 0){var o=e.querySelector(":checked");o!==null&&(s=R(o),n(s))}e.__value=s,a=!1}),ut(e)}function R(e){return"__value"in e?e.__value:e.value}function ke(e,t,n=t){var a=new WeakSet;fe(e,"input",async s=>{var o=s?e.defaultValue:e.value;if(o=se(e)?oe(o):o,n(o),O!==null&&a.add(O),await at(),o!==(o=t())){var c=e.selectionStart,v=e.selectionEnd;e.value=o??"",v!==null&&(e.selectionStart=c,e.selectionEnd=Math.min(v,e.value.length))}}),(Te&&e.defaultValue!==e.value||Ue(t)==null&&e.value)&&(n(se(e)?oe(e.value):e.value),O!==null&&a.add(O)),Oe(()=>{var s=t();if(e===document.activeElement){var o=rt??O;if(a.has(o))return}se(e)&&s===oe(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function bt(e,t,n=t){fe(e,"change",a=>{var s=a?e.defaultChecked:e.checked;n(s)}),(Te&&e.defaultChecked!==e.checked||Ue(t)==null)&&n(e.checked),Oe(()=>{var a=t();e.checked=!!a})}function se(e){var t=e.type;return t==="number"||t==="range"}function oe(e){return e===""?null:+e}let b,C=null;function M(){return(C===null||C.byteLength===0)&&(C=new Uint8Array(b.memory.buffer)),C}let z=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&z.decode();const _t=2146435072;let ie=0;function vt(e,t){return ie+=t,ie>=_t&&(z=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}},z.decode(),ie=t),z.decode(M().subarray(e,e+t))}function le(e,t){return e=e>>>0,vt(e,t)}function Ae(e,t){return e=e>>>0,M().subarray(e/1,e/1+t)}let j=0;const L=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},pt=typeof L.encodeInto=="function"?function(e,t){return L.encodeInto(e,t)}:function(e,t){const n=L.encode(e);return t.set(n),{read:e.length,written:n.length}};function Re(e,t,n){if(n===void 0){const v=L.encode(e),g=t(v.length,1)>>>0;return M().subarray(g,g+v.length).set(v),j=v.length,g}let a=e.length,s=t(a,1)>>>0;const o=M();let c=0;for(;c<a;c++){const v=e.charCodeAt(c);if(v>127)break;o[s+c]=v}if(c!==a){c!==0&&(e=e.slice(c)),s=n(s,a,a=c+e.length*3,1)>>>0;const v=M().subarray(s+c,s+a),g=pt(e,v);c+=g.written,s=n(s,a,c,1)>>>0}return j=c,s}let x=null;function Se(){return(x===null||x.buffer.detached===!0||x.buffer.detached===void 0&&x.buffer!==b.memory.buffer)&&(x=new DataView(b.memory.buffer)),x}function wt(e){const t=b.__wbindgen_export_3.get(e);return b.__externref_table_dealloc(e),t}function mt(e,t,n,a){const s=Re(n,b.__wbindgen_malloc,b.__wbindgen_realloc),o=j,c=b.convert_bin_to_uf2(e,t,s,o,a);if(c[2])throw wt(c[1]);return ue.__wrap(c[0])}const Ee=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>b.__wbg_conversionoutput_free(e>>>0,1));class ue{static __wrap(t){t=t>>>0;const n=Object.create(ue.prototype);return n.__wbg_ptr=t,Ee.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Ee.unregister(this),t}free(){const t=this.__destroy_into_raw();b.__wbg_conversionoutput_free(t,0)}get data(){return b.conversionoutput_data(this.__wbg_ptr)}get startOffset(){return b.conversionoutput_startOffset(this.__wbg_ptr)>>>0}get slot(){return b.conversionoutput_slot(this.__wbg_ptr)}}const gt=new Set(["basic","cors","default"]);async function ht(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(a){if(e.ok&&gt.has(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function yt(){const e={};return e.wbg={},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,n){let a,s;try{a=t,s=n,console.error(le(t,n))}finally{b.__wbindgen_free(a,s,1)}},e.wbg.__wbg_length_904c0910ed998bf3=function(t){return t.length},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},e.wbg.__wbg_newfromslice_d0d56929c6d9c842=function(t,n){return new Uint8Array(Ae(t,n))},e.wbg.__wbg_prototypesetcall_c5f74efd31aea86b=function(t,n,a){Uint8Array.prototype.set.call(Ae(t,n),a)},e.wbg.__wbg_random_57255a777f5a0573=function(){return Math.random()},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,n){const a=n.stack,s=Re(a,b.__wbindgen_malloc,b.__wbindgen_realloc),o=j;Se().setInt32(t+4,o,!0),Se().setInt32(t+0,s,!0)},e.wbg.__wbg_wbindgenthrow_4c11a24fca429ccf=function(t,n){throw new Error(le(t,n))},e.wbg.__wbindgen_cast_2241b6af4c4b2941=function(t,n){return le(t,n)},e.wbg.__wbindgen_init_externref_table=function(){const t=b.__wbindgen_export_3,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e}function xt(e,t){return b=e.exports,Me.__wbindgen_wasm_module=t,x=null,C=null,b.__wbindgen_start(),b}async function Me(e){if(b!==void 0)return b;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL(""+new URL("../assets/converter_bg.BkSNl3T7.wasm",import.meta.url).href,import.meta.url));const t=yt();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:a}=await ht(await e,t);return xt(n,a)}let ce=null;async function kt(){return ce||(ce=Me().then(()=>{})),ce}async function At(e,t){await kt();let n;try{n=mt(e,t.slot,t.name,t.autoclockHz)}catch(o){throw new Error(typeof o=="string"?o:o.message)}const s={data:new Uint8Array(n.data),startOffset:n.startOffset,slot:n.slot};return n.free(),s}var St=F('<span class="loading loading-spinner"></span> Converting…',1),Et=F('<span class="text-sm text-base-content/70"> </span>'),Ut=F('<div class="alert alert-error"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="h-6 w-6 shrink-0 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),Ot=F('<div class="alert alert-success items-center justify-between gap-4"><div class="flex flex-col"><h2 class="font-semibold">Conversion ready</h2> <p class="text-sm">Start offset <code> </code> </p></div> <a class="btn btn-sm btn-neutral ml-auto"> </a></div>'),Tt=F('<div class="min-h-screen bg-base-200"><div class="mx-auto flex w-full max-w-4xl flex-col gap-6 px-4 py-10"><div class="text-center"><h1 class="text-3xl font-bold">BIN → UF2 Converter</h1> <p class="mt-2 text-base-content/80">Convert FPGA bitstream binaries into UF2 packets that match the efabless target profile.</p></div> <div class="card bg-base-100 shadow-xl"><div class="card-body space-y-6"><div class="grid gap-6 md:grid-cols-2"><label class="form-control w-full"><div class="label"><span class="label-text font-semibold">Bitstream (.bin) file</span></div> <input class="file-input file-input-bordered w-full" type="file" accept=".bin,application/octet-stream"/></label> <label class="form-control w-full"><div class="label"><span class="label-text font-semibold">Display name</span> <span class="label-text-alt"></span></div> <input class="input input-bordered" placeholder="Optional project name"/></label> <label class="form-control w-full"><div class="label"><span class="label-text font-semibold">Slot</span></div> <select class="select select-bordered"><option>Slot 1</option><option>Slot 2</option><option>Slot 3</option><option>Slot 4</option></select></label> <label class="form-control w-full"><div class="label"><span class="label-text font-semibold">Auto-clock (Hz)</span> <span class="label-text-alt">0 for default</span></div> <input class="input input-bordered" type="number" min="0" max="60000000" step="1" placeholder="10 - 60000000"/></label></div> <label class="label cursor-pointer justify-start gap-3"><input type="checkbox" class="checkbox"/> <span class="label-text">Append slot number to the downloaded filename</span></label> <div class="flex flex-wrap items-center justify-between gap-3"><button class="btn btn-primary"><!></button> <!></div> <!> <!></div></div> <div class="card bg-base-100 shadow"><div class="card-body space-y-3 text-sm text-base-content/70"><h2 class="card-title text-base">Notes</h2> <ul class="list-disc space-y-1 pl-5"><li>The converter always targets the efabless UF2 profile.</li> <li></li> <li>Auto-clock values must fall between 10 Hz and 60 MHz; leave blank to retain the board default.</li> <li>Generated UF2 files stay in-browser; refresh to clear cached links.</li></ul></div></div></div></div>');function Dt(e,t){st(t,!1);const n=23;let a=y(null),s=y(1),o=y(""),c=y(""),v=y(!1),g=y(!1),S=y(""),w=y(null);function Fe(r){const l=r.target;m(a,l.files?.[0]??null)}Ke(()=>{i(w)?.url&&URL.revokeObjectURL(i(w).url)});function Ne(){i(w)?.url&&URL.revokeObjectURL(i(w).url),m(w,null),m(S,"")}async function Be(){if(Ne(),!i(a)){m(S,"Select a .bin file to convert.");return}m(g,!0);try{const r=new Uint8Array(await i(a).arrayBuffer()),l=De(i(o),i(a).name),_=ze(i(c)),p=Number(i(s));if(!Number.isInteger(p)||p<1||p>4)throw new Error("Slot must be an integer between 1 and 4.");const h=await At(r,{slot:p,name:l,autoclockHz:_}),N=h.data,B=new ArrayBuffer(N.length);new Uint8Array(B).set(N);const k=new Blob([B],{type:"application/octet-stream"}),ee=URL.createObjectURL(k),te=Le(l,p,i(v));m(w,{url:ee,fileName:te,startOffset:h.startOffset,size:h.data.length})}catch(r){m(S,r instanceof Error?r.message:String(r))}finally{m(g,!1)}}function De(r,l){const _=r.trim();return _.length>0?_.slice(0,n):l.replace(/\.[^.]+$/,"").slice(0,n)}function ze(r){if(r.trim().length===0)return 0;const l=Number(r);if(!Number.isFinite(l))throw new Error("Provide a numeric auto-clock value in Hz.");const _=Math.trunc(l);if(_!==0&&(_<10||_>6e7))throw new Error("Auto-clock must be between 10 and 60,000,000 Hz.");return _}function Le(r,l,_){const p=r.length?r:"bitstream",h=_?`_slot${l}`:"";return`${p}${h}.uf2`}Je();var W=Tt();ot(r=>{lt.title="BIN → UF2 Converter"});var de=u(W),I=f(u(de),2),be=u(I),$=u(be),q=u($),je=f(u(q),2);d(q);var H=f(q,2),P=u(H),We=f(u(P),2);We.textContent="max 23 characters",d(P);var V=f(P,2);re(V),ae(V,"maxlength",n),d(H);var G=f(H,2),X=f(u(G),2);T(()=>{i(s),ct(()=>{})});var Y=u(X);Y.value=Y.__value=1;var J=f(Y);J.value=J.__value=2;var K=f(J);K.value=K.__value=3;var _e=f(K);_e.value=_e.__value=4,d(X),d(G);var ve=f(G,2),pe=f(u(ve),2);re(pe),d(ve),d($);var Q=f($,2),we=u(Q);re(we),ne(2),d(Q);var Z=f(Q,2),E=u(Z),Ie=u(E);{var $e=r=>{var l=St();ne(),A(r,l)},qe=r=>{var l=ft("Convert to UF2");A(r,l)};D(Ie,r=>{i(g)?r($e):r(qe,!1)})}d(E);var He=f(E,2);{var Pe=r=>{var l=Et(),_=u(l);d(l),T(()=>U(_,`Loaded file: ${i(a).name??""}`)),A(r,l)};D(He,r=>{i(a)&&r(Pe)})}d(Z);var me=f(Z,2);{var Ve=r=>{var l=Ut(),_=f(u(l),2),p=u(_,!0);d(_),d(l),T(()=>U(p,i(S))),A(r,l)};D(me,r=>{i(S)&&r(Ve)})}var Ge=f(me,2);{var Xe=r=>{var l=Ot(),_=u(l),p=f(u(_),2),h=f(u(p)),N=u(h,!0);d(h);var B=f(h);d(p),d(_);var k=f(_,2),ee=u(k);d(k),d(l),T(te=>{U(N,te),U(B,`, UF2 size ${i(w).size??""}
                bytes.`),ae(k,"href",i(w).url),ae(k,"download",i(w).fileName),U(ee,`Download ${i(w).fileName??""}`)},[()=>`0x${i(w).startOffset.toString(16)}`]),A(r,l)};D(Ge,r=>{i(w)&&r(Xe)})}d(be),d(I);var ge=f(I,2),he=u(ge),ye=f(u(he),2),Ye=f(u(ye),2);Ye.textContent=`Bitstream names longer than 23 characters are truncated to match the metadata header
            limit.`,ne(4),d(ye),d(he),d(ge),d(de),d(W),T(()=>E.disabled=i(g)),xe("change",je,Fe),ke(V,()=>i(o),r=>m(o,r)),dt(X,()=>i(s),r=>m(s,r)),ke(pe,()=>i(c),r=>m(c,r)),bt(we,()=>i(v),r=>m(v,r)),xe("click",E,Be),A(e,W),it()}export{Dt as component};
